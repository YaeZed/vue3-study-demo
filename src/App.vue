<template>
  <!-- <commandBasic></commandBasic> -->
  <!-- <refFamily></refFamily> -->
  <!-- <reactiveFamily></reactiveFamily> -->
  <!-- <toFamily></toFamily> -->
  <!-- <computed></computed> -->
  <!-- <watchBasic></watchBasic> -->

  <!-- ç”Ÿå‘½å‘¨æœŸeg -->
  <!-- <lifeCircle v-if="display"></lifeCircle>
  <button @click="display = !display">ç‚¹å‡»åˆ‡æ¢ç»„ä»¶</button> -->

  <!-- çˆ¶å­ç»„ä»¶ä¼ å‚eg -->
  <!-- <div class="parent-container">
    <h2>çˆ¶ç»„ä»¶</h2>
    <label>æ›´æ–°ç»™å­ç»„ä»¶çš„æ¶ˆæ¯ï¼š</label>
    <input type="text" v-model="messageForChild" />
  </div>

  <p>
    ä»å­ç»„ä»¶æ”¶åˆ°çš„æ¶ˆæ¯: <strong>{{ messageFromChild }}</strong>
  </p>

  <hr />

  <props_emits
    :main-message="messageForChild"
    @update-message="handleChildMessage"
  ></props_emits> -->

  <!-- å…¨å±€ç»„ä»¶ -->
  <!-- <base-button>å…¨å±€æŒ‰é’®ç»„ä»¶</base-button> -->

  <!-- é€’å½’ç»„ä»¶ -->
  <!-- <treeNode :node="fileTree"></treeNode> -->

  <!-- å…¨å±€åŠ¨æ€ç»„ä»¶ -->
  <!-- <div style="display: flex">
    <button v-for="data in dynamics" @click="changeComponent(data)">
      {{ data.name }}
    </button>
  </div>
  <hr />
  <component :is="currentComponent" :message="currentMessage"></component> -->

  <!-- æ’æ§½ -->
  <!-- <slotBasic>
    <p>è¿™æ˜¯çˆ¶ç»„ä»¶</p>
    <img src="./assets/macllen.PNG" alt="macllen" style="width: 100px" />

    
    <template #header>
      <h2>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ€æ¡†æ ‡é¢˜</h2>
    </template>

    <template #main>
      <p>è¿™æ˜¯æ¨¡æ€æ¡†çš„ä¸»è¦å†…å®¹</p>
    </template>

    <template #footer>
      <button>å–æ¶ˆ</button>
      <button>ç¡®è®¤</button>
    </template>

    
    <template #user-item="{ user, isAdmin }: { user: User, isAdmin: boolean }">
      <span> {{ user.name }}-{{ user.age }}å² </span>
      <span v-if="isAdmin" style="color: red; margin-left: 10px">[ç®¡ç†å‘˜]</span>
    </template>
  </slotBasic> -->

  <!-- å¼‚æ­¥ç»„ä»¶ -->
  <!-- <Suspense>
    <template #default>
      <AsyncUserCard />
    </template>
    <template #fallback>
      <skeleton />
    </template>
  </Suspense> -->

  <!-- ä¼ é€ç»„ä»¶æ¨¡æ€æ¡† -->
  <!-- <div class="parent-container">
    <h1>çˆ¶ç»„ä»¶é¡µé¢</h1>
    <p>å³ä½¿è¿™é‡Œçš„çˆ¶çº§è®¾ç½®äº† overflow: hiddenï¼ŒModal ä¾ç„¶ä¼šå…¨å±æ˜¾ç¤ºã€‚</p>

    <button @click="showModal = true">æ‰“å¼€æ¨¡æ€æ¡†</button>

    <teleModal
      v-model:isOpen="showModal"
      title="ç”¨æˆ·åè®®"
      @confirm="handleConfirm"
    >
      <p>è¿™é‡Œæ˜¯æ¨¡æ€æ¡†çš„å…·ä½“å†…å®¹...</p>
      <p>è¿™æ˜¯ä¸€ä¸ª TypeScript ç¼–å†™çš„ Teleport ç¤ºä¾‹ã€‚</p>
    </teleModal>
  </div> -->
  <!-- keep-alive -->
  <!-- <el-button type="primary" @click="display = !display">åˆ‡æ¢ç»„ä»¶</el-button>
  <KeepAlive :include="['eleA']" :exclude="['eleB']" :max="10">
    <eleA v-if="display"></eleA>
    <eleB v-else></eleB>
  </KeepAlive> -->
  <!-- åŠ¨ç”»ç»„ä»¶ -->
  <transitionEl></transitionEl>
</template>

<script setup lang="ts">
import { ref, type Component, markRaw, shallowRef, Suspense } from "vue";
import commandBasic from "./components/commandBasic.vue";
import refFamily from "./components/refFamily.vue";
import reactiveFamily from "./components/reactiveFamily.vue";
import toFamily from "./components/toFamily.vue";
import computed from "./components/computed.vue";
// import watchBasic from "./components/watchBasic.vue";
import lifeCircle from "./components/lifeCircle.vue";
import props_emits from "./components/props_emits.vue";
import treeNode from "./components/treeNode.vue";
// æ’æ§½
import slotBasic from "./components/slotBasic.vue";
// æ¨¡æ€æ¡†
import teleModal from "./components/teleModal.vue";
// keep-alive
import eleA from "./components/elementPlus/eleA.vue";
import eleB from "./components/elementPlus/eleB.vue";

// åŠ¨æ€ç»„ä»¶
import A from "./components/dynamics/A.vue";
import B from "./components/dynamics/B.vue";
import C from "./components/dynamics/C.vue";

// åŠ¨ç”»ç»„ä»¶
import transitionEl from "./components/transitionEl.vue";
const display = ref(true);

/**
 * çˆ¶å­ç»„ä»¶ä¼ å‚
 */
// çˆ¶ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€
const messageForChild = ref("ä½ å¥½ï¼Œå­ç»„ä»¶ï¼è¿™æ˜¯æ¥è‡ªçˆ¶ç»„ä»¶çš„æ¶ˆæ¯ã€‚");
const messageFromChild = ref("...ç­‰å¾…å­ç»„ä»¶çš„æ¶ˆæ¯..."); // å­˜æ”¾ä»å­ç»„ä»¶æ”¶åˆ°çš„æ¶ˆæ¯

// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¤„ç†å­ç»„ä»¶è§¦å‘çš„ 'updateMessage' äº‹ä»¶
// TypeScript åœ¨è¿™é‡Œå¯ä»¥æ ¹æ®å­ç»„ä»¶çš„ emit å®šä¹‰è‡ªåŠ¨æ¨æ–­ 'newMessage' çš„ç±»å‹ä¸º string
const handleChildMessage = (newMessage: string) => {
  messageFromChild.value = newMessage;
};

/**
 * é€’å½’ç»„ä»¶
 */
import type { TreeNodeData } from "./components/ts/types";

// mockæ•°æ®
const fileTree = ref<TreeNodeData>({
  id: "root",
  label: "é¡¹ç›®æ ¹ç›®å½• (src)",
  children: [
    {
      id: "c1",
      label: "components",
      children: [
        { id: "c1-1", label: "TreeNode.vue" },
        { id: "c1-2", label: "BaseButton.vue" },
      ],
    },
    {
      id: "c2",
      label: "views",
      children: [{ id: "c2-1", label: "HomePage.vue" }],
    },
    {
      id: "c3",
      label: "App.vue",
      // è¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰ childrenï¼Œé€’å½’å°†åœ¨æ­¤å¤„åœæ­¢
    },
  ],
});

/**
 * å…¨å±€åŠ¨æ€ç»„ä»¶
 */
// 2. å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥æ˜ å°„ç»„ä»¶åç§°æˆ–é”®
// ä½¿ç”¨ markRaw å‘Šè¯‰ Vue è¿™äº›ç»„ä»¶ä¸éœ€è¦è¢«æ·±åº¦å“åº”å¼å¤„ç†ï¼Œå¯ä»¥ä¼˜åŒ–æ€§èƒ½
const componentsMap: Record<string, Component> = {
  ComponentA: markRaw(A),
  ComponentB: markRaw(B),
  ComponentC: markRaw(C),
};
// å®šä¹‰ä¸€ä¸ªdynamicsæ•°ç»„
// å…¶ä¸­æ¯ä¸ªå¯¹è±¡åŒ…å«ç»„ä»¶åç§°ã€ç»„ä»¶å¯¹è±¡ã€ç»™ç»„ä»¶ä¼ é€’çš„æ¶ˆæ¯
interface DynamicData {
  name: string;
  com: Component;
  message: string;
}

const dynamics = ref<DynamicData[]>([
  {
    name: "ComponentA",
    com: componentsMap.ComponentA,
    message: "hello world",
  },
  {
    name: "ComponentB",
    com: componentsMap.ComponentB,
    message: "welcome",
  },
  {
    name: "ComponentC",
    com: componentsMap.ComponentC,
    message: "YaeZed",
  },
]);

// 3.åˆ›å»º ref æ¥å­˜å‚¨å½“å‰è¦æ¸²æŸ“çš„ç»„ä»¶å¯¹è±¡å’Œä¼ é€’ç»™å­ç»„ä»¶çš„æ¶ˆæ¯
// ä½¿ç”¨ shallowRef æ˜¯æœ€ä½³å®è·µï¼Œå› ä¸ºç»„ä»¶å¯¹è±¡æœ¬èº«ä¸éœ€è¦æ·±åº¦å“åº”
// å¹¶ä½¿ç”¨ Component ç±»å‹ï¼Œå®ƒä» 'vue' å¯¼å…¥
const currentComponent = shallowRef<Component>(componentsMap.ComponentA);
const currentMessage = ref("hello world");

// 4.å®šä¹‰åˆ‡æ¢ç»„ä»¶çš„æ–¹æ³•
const changeComponent = (data: DynamicData) => {
  currentComponent.value = data.com;
  currentMessage.value = data.message;
};

// ä½œç”¨åŸŸæ’æ§½
// å¯ä»¥ï¼ˆä¹Ÿåº”è¯¥ï¼‰åœ¨çˆ¶ç»„ä»¶ä¸­ä¹Ÿå®šä¹‰è¿™ä¸ªç±»å‹ï¼Œä»¥ä¾¿å¤ç”¨
interface User {
  id: number;
  name: string;
  age: number;
}

// å¼‚æ­¥ç»„ä»¶
import { defineAsyncComponent } from "vue";
/**
 * 1.åŒæ­¥å¯¼å…¥éª¨æ¶å±
 * "fallbackå†…å®¹æ˜¯åŒæ­¥çš„ï¼Œå¯ä»¥ç«‹å³æ¸²æŸ“"
 */
import skeleton from "./components/skeleton.vue";

/**
 * 2.å¼‚æ­¥å¯¼å…¥çœŸå®ç»„ä»¶
 * ä½¿ç”¨ `defineAsyncComponent` æ¥â€œåŒ…è£…â€ã€‚
 * è¿™å‘Šè¯‰ Vue è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼Œåº”è¯¥æ‡’åŠ è½½ã€‚
 */
// ----------------------------------------------------
// ğŸ’¡ (å¯é€‰) å¦‚ä½•åœ¨æœ¬åœ°æµ‹è¯•éª¨æ¶å±:
//
// åœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œ`card.vue` åŠ è½½å¾—å¤ªå¿«ï¼Œä½ å¯èƒ½
// çœ‹ä¸åˆ°éª¨æ¶å±ã€‚ä½ å¯ä»¥åƒè¿™æ ·æ¨¡æ‹Ÿä¸€ä¸ª 2 ç§’çš„ç½‘ç»œå»¶è¿Ÿï¼š
//
const AsyncUserCard = defineAsyncComponent(() => {
  return new Promise((resolve) => {
    setTimeout(() => {
      // @ts-ignore
      resolve(import("./components/card.vue"));
    }, 1500); // å»¶è¿Ÿ 1.5 ç§’
  });
});
// ----------------------------------------------------

// ä¼ é€ç»„ä»¶
const showModal = ref(true);
const handleConfirm = () => {
  console.log("confirm");
};
</script>

<style scoped>
.parent-container {
  border: 2px solid #34495e;
  background-color: #f0f8ff;
  padding: 20px;
  border-radius: 8px;
}
input {
  margin-left: 10px;
}
button {
  padding: 20px 20px;
  margin: 10px 10px;
  font-size: 20px;
}
.parent-container {
  /* æ¨¡æ‹Ÿä¸€ä¸ªå—é™çš„å¸ƒå±€ç¯å¢ƒ */
  transform: translateZ(0);
  overflow: hidden;
  height: 200px;
  border: 1px solid #ccc;
  padding: 20px;
}
</style>
